networks:
  hasher: 
    internal: true
  redis: 
    internal: true
  rng:
    internal: true
  webui:
      internal: false
  worker:
    internal: true
services:
  hasher:
    deploy: 
      mode: replicated
      placement: 
        constraints: 
          - node.role == worker
      replicas: 2
    expose:
      - 8080
    image: mjgrppr/mj-dockercoins:latest-hasher
    networks:
      - hasher
  redis:
    deploy: 
      mode: replicated
      placement: 
        constraints: 
          - node.role == worker
      replicas: 1
    expose:
      - 6379
    image: redis:6.0.9-alpine3.12@sha256:aa31e6d2afc72d2222ed3953587197c324f615861771637a64053f9d99ba4b74
    networks:
      - redis
    # volums escribe en disco, p openshift
    volumes:    
      - redis-volume: /data
  rng:
    deploy: 
      #DaemonSet, es una app q se despliega 1 vez por worker --> mmode global
      mode: global
      placement: 
        constraints: 
          - node.role == worker
      replicas: 2
    expose:
      - 8080
    image: mjgrppr/mj-dockercoins:latest-rng
    networks:
      - rng
  webui:
    deploy: 
      mode: replicated
      placement: 
        constraints: 
          - node.role == worker
      replicas: 2
    image: mjgrppr/mj-dockercoins:latest-webui
    networks:
      - redis
      - webui
    ports:
      - 80:8080
  worker:
    deploy: 
      mode: replicated
      placement: 
        constraints: 
          - node.role == worker
      replicas: 2
    image: mjgrppr/mj-dockercoins:latest-worker
    networks:
      - hasher
      - redis
      - rng
      - worker
version: '3.8'      
volumes: 
  redis:
